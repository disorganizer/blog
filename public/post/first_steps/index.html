<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Don&#39;t panic">

<base href="https://disorganizer.github.io/blog">
<title>


     A brig step for mankind 

</title>
<link rel="canonical" href="https://disorganizer.github.io/blog/post/first_steps/">


<script type="text/javascript">
    var baseURL = 'https:\/\/disorganizer.github.io\/blog';
    var host = baseURL.substring(0, baseURL.length - 1).replace(/\//g, '');
    if ((host === window.location.host) && (window.location.protocol !== 'https:')) {
        window.location.protocol = 'https:';
    }
</script>





<link rel="stylesheet" href="https://disorganizer.github.io/blog/css/reset.css">
<link rel="stylesheet" href="https://disorganizer.github.io/blog/css/pygments.css">
<link rel="stylesheet" href="https://disorganizer.github.io/blog/css/main.css">






<link rel="shortcut icon"

    href="https://disorganizer.github.io/blog/img/favicon.ico"

>



</head>


<body lang="en">

<section class="header"> 
    <div class="container">
        <div class="content">
            <a href="https://disorganizer.github.io/blog/"><div class="name">Chris Pahl</div></a>
            <nav>
                <ul>
                    <a href="https://disorganizer.github.io/blog/blog/"><li>Blog</li></a>
                    <a href="https://disorganizer.github.io/blog/about/"><li>About</li></a>
                    <a href="https://disorganizer.github.io/blog/code/"><li>Code</li></a>
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">

        
            <a href="//github.com/sahib" target="_blank">
                <i class="icon ion-social-github"></i>
            </a>
        
        
        

        

        

        

        
            <a href="mailto:sahib@online.de">
                <i class="icon ion-ios-email larger"></i>
            </a>
        
        </div>
    </div>
</section>

<section class="main">
    <div class="container">
        <div class="content">
            <p>A small historic moment was achieved today: The very first file was added to
<code>brig</code>. There was no way to get it out again, but hey - Progress comes in
steps. Luckily, just two hours later there was a <code>brig get</code> command that
could retrieve the file again from <code>ipfs</code>.</p>

<p>This is also my very first devlog entry, so&hellip; Hi. I mainly write this to
remember what I did (and when) on the course of the project. Also it sometimes
is really useful to reflect on what kind of boolshit I wrote today. Ever
noticed that you get the best ideas doing arbitrary things like peeing? That&rsquo;s
the same effect, I guess. If it&rsquo;s fun to read for others&hellip; that&rsquo;s okay too.
I try to keep it updated after every more or less productive session.
That might mean daily, that might also mean once a week.</p>

<p>So, back to the technical side of life. <code>brig add</code> currently works a bit
confusing. It is supposed to read a regular file on the disk, compress and
encrypt it and add it to <code>ipfs</code>. The encryption and compression layer uses
<code>io.Writer</code> though, so we can&rsquo;t just stack <code>io.Reader</code> on top of each
other. Instead we need to use a nice little feature from the stdlib:
<code>io.Pipe()</code>. This function returns a <code>io.Writer</code> and a <code>io.Reader</code>. Every
write on the writer produces a corresponding read on the reader - without internal
copying of the data. Yay. If you have a piece of API that needs a <code>io.Reader</code>,
but you just have a <code>io.Writer</code>, then <code>io.Pipe()</code> should pop into your mind now.</p>

<p>Here&rsquo;s how it looks in practice:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">func</span> <span style="color: #a6e22e">NewFileReader</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">key</span> <span style="color: #f8f8f2">[]</span><span style="color: #66d9ef">byte</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">r</span> <span style="color: #a6e22e">io</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Reader</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">io</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Reader</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">error</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #a6e22e">pr</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">pw</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">io</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Pipe</span><span style="color: #f8f8f2">()</span>

	<span style="color: #75715e">// Setup the writer part:</span>
	<span style="color: #a6e22e">wEnc</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">encrypt</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NewWriter</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">pw</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">key</span><span style="color: #f8f8f2">)</span>
	<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #66d9ef">nil</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">err</span>
	<span style="color: #f8f8f2">}</span>

	<span style="color: #a6e22e">wZip</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">compress</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">NewWriter</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">wEnc</span><span style="color: #f8f8f2">)</span>

	<span style="color: #75715e">// Suck the reader empty and move it to `wZip`.</span>
	<span style="color: #75715e">// Every write to wZip will be available as read in `pr`.</span>
	<span style="color: #66d9ef">go</span> <span style="color: #66d9ef">func</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #66d9ef">defer</span> <span style="color: #66d9ef">func</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
			<span style="color: #a6e22e">wEnc</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Close</span><span style="color: #f8f8f2">()</span>
			<span style="color: #a6e22e">pw</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Close</span><span style="color: #f8f8f2">()</span>
		<span style="color: #f8f8f2">}()</span>

		<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">_</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">:=</span> <span style="color: #a6e22e">io</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Copy</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">wZip</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">r</span><span style="color: #f8f8f2">);</span> <span style="color: #a6e22e">err</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2">{</span>
			<span style="color: #a6e22e">log</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Warningf</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;add: copy: %v&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">err</span><span style="color: #f8f8f2">)</span>
		<span style="color: #f8f8f2">}</span>
	<span style="color: #f8f8f2">}()</span>

	<span style="color: #66d9ef">return</span> <span style="color: #a6e22e">pr</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">nil</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>That&rsquo;s all for today! For tomorrow a cleanup session is planned and the piece
of code that derives the AES-Key from an unencrypted file.</p>

        </div>
    </div>
</section>




</body>
</html>

